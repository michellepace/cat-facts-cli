repos:
  - repo: https://github.com/astral-sh/uv-pre-commit
    rev: 0.9.8
    hooks:
      - id: uv-lock

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.4
    hooks:
      # Run the formatter
      - id: ruff-format
      # Run the linter
      - id: ruff-check
        args: [--fix, --exit-non-zero-on-fix]

  - repo: local
    hooks:
      # Type checking (uses uv run to access project venv)
      - id: pyright
        name: pyright
        entry: uv run pyright
        language: system
        types: [python]
        pass_filenames: false

      # Run all tests
      - id: pytest
        name: pytest
        entry: uv run pytest
        language: system
        files: \.(py)$|^pyproject\.toml$|^uv\.lock$
        pass_filenames: false

# Notes:
# 1. `uv-lock` hook re-resolves and regenerates the lockfile to match pyproject.toml
# 2. `ruff-format` runs before `ruff-check` (format then lint)
# 3. `--exit-non-zero-on-fix` flag blocks commits when ruff makes automatic fixes, must review first
# 4. `pyright` runs type checking to catch type errors before commits
# 5. `pass_filenames: false` on pytest runs the full test suite rather than only testing modified files
# 6. pytest also triggers on pyproject.toml/uv.lock changes to catch dependency breakage
